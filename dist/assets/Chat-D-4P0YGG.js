import{j as e,c as oe,u as G,r as n,d as re,e as U,_ as C,f as N,h as ie,m as E,i as ae,k as ce,l as le,n as me,o as de,C as ue,p as pe,q as ge,t as fe,S as D,T as he,I as xe,v as O,w as $,N as B,A as je}from"./index-zoCVIjJL.js";import{b as ye}from"./index-BqsNzaDg.js";import{M as ve,a as Me}from"./Menu-BjFoS8hj.js";import{M as L,L as T}from"./MenuItem-CfIin0j1.js";import{T as b}from"./Tooltip-EEba8WSd.js";import{c as M,T as w}from"./Modal-D8Ubx5EF.js";import{m as Se,A as Ae}from"./AppLayout-Do6qrJIR.js";import{R as Ce}from"./RenderAttachment-CEXoapnV.js";import{B as Le,u as Te,a as be}from"./hook-Bpn_aVtV.js";import{I as P}from"./IconButton-DbI5Ym2I.js";import"./ButtonBase-Cn_JI8Ky.js";import"./Toolbar-B3MsHQCj.js";import"./Delete-BOD66oR7.js";import"./Notifications-kW8UmErF.js";import"./AvatarCard-CYXcyeTD.js";import"./Avatar-CEZlIwUk.js";import"./ExitToApp-CHaBDJQy.js";const ke=M(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),Fe=M(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile"),Ve=M(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),Ie=M(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),we=M(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Ee=M(e.jsx("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile"),Re=({anchorE1:t,chatId:a})=>{const{isFileMenu:r}=oe(s=>s.misc),c=G(),m=n.useRef(null),d=n.useRef(null),l=n.useRef(null),u=n.useRef(null),[h]=re(),p=()=>c(U(!1)),g=()=>{var s;return(s=m.current)==null?void 0:s.click()},x=()=>{var s;return(s=d.current)==null?void 0:s.click()},k=()=>{var s;return(s=l.current)==null?void 0:s.click()},F=()=>{var s;return(s=u.current)==null?void 0:s.click()},j=async(s,y)=>{const v=Array.from(s.target.files);if(v.length<=0)return;if(v.length>5)return C.error(`You can only send 5 ${y} at a time`);c(N(!0));const f=C.loading(`Sending ${y}...`);p();try{const i=new FormData;i.append("chatId",a),v.forEach(V=>i.append("files",V)),(await h(i)).data?C.success(`${y} sent successfully`,{id:f}):C.error(`Failed to send ${y}`,{id:f})}catch(i){C.error(i,{id:f})}finally{c(N(!1))}};return e.jsx(ve,{anchorEl:t,open:r,onClose:p,children:e.jsx("div",{style:{width:"10rem"},children:e.jsxs(Me,{children:[e.jsxs(L,{onClick:g,children:[e.jsx(b,{title:"Image",children:e.jsx(Ve,{})}),e.jsx(T,{style:{marginLeft:"0.5rem"},children:"Image"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif",style:{display:"none"},onChange:s=>j(s,"Images"),ref:m})]}),e.jsxs(L,{onClick:x,children:[e.jsx(b,{title:"Audio",children:e.jsx(Fe,{})}),e.jsx(T,{style:{marginLeft:"0.5rem"},children:"Audio"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:s=>j(s,"Audios"),ref:d})]}),e.jsxs(L,{onClick:k,children:[e.jsx(b,{title:"Video",children:e.jsx(Ee,{})}),e.jsx(T,{style:{marginLeft:"0.5rem"},children:"Video"}),e.jsx("input",{type:"file",multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:s=>j(s,"Videos"),ref:l})]}),e.jsxs(L,{onClick:F,children:[e.jsx(b,{title:"File",children:e.jsx(we,{})}),e.jsx(T,{style:{marginLeft:"0.5rem"},children:"File"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",style:{display:"none"},onChange:s=>j(s,"Files"),ref:u})]})]})})})},He=({message:t,user:a})=>{const{sender:r,content:c,attachments:m=[],createdAt:d}=t,l=(r==null?void 0:r._id)===(a==null?void 0:a._id),u=ie(d).fromNow();return e.jsxs(Se.div,{initial:{opacity:0,x:"-100%"},whileInView:{opacity:1,x:0},style:{alignSelf:l?"flex-end":"flex-start",backgroundColor:"white",color:"black",borderRadius:"5px",padding:"0.5rem",width:"fit-content"},children:[!l&&e.jsx(w,{color:E,fontWeight:"800",variant:"caption",children:r.name}),c&&e.jsx(w,{children:c}),m.length>0&&m.map((h,p)=>{const g=h.url,x=ae(g);return e.jsx(Le,{children:e.jsx("a",{href:g,target:"_blank",download:!0,style:{color:"black"},children:Ce(x,g)})},p)}),e.jsx(w,{variant:"caption",color:"text.secondary",children:u})]})},_e=n.memo(He),ze=({chatId:t,user:a})=>{var R,H,_,z;const r=ce(),c=G();le();const m=n.useRef(null),d=n.useRef(null),[l,u]=n.useState(""),[h,p]=n.useState([]),[g,x]=n.useState(1),[k,F]=n.useState(null),[j,s]=n.useState(!1),[y,v]=n.useState(!1),f=n.useRef(null),i=me({chatId:t,skip:!t}),S=de({chatId:t,page:g}),{data:V,setData:Y}=ye(m,(R=S.data)==null?void 0:R.totalPages,g,x,(H=S.data)==null?void 0:H.messages),Q=[{isError:i.isError,error:i.error},{isError:S.isError,error:S.error}],A=(z=(_=i==null?void 0:i.data)==null?void 0:_.chat)==null?void 0:z.members,W=o=>{u(o.target.value),j||(r.emit(O,{members:A,chatId:t}),s(!0)),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{r.emit($,{members:A,chatId:t}),s(!1)},[2e3])},q=o=>{c(U(!0)),F(o.currentTarget)},J=o=>{o.preventDefault(),l.trim()&&(r.emit(B,{chatId:t,members:A,message:l}),u(""))};n.useEffect(()=>(r.emit(ue,{userId:a._id,members:A}),c(pe(t)),()=>{p([]),u(""),Y([]),x(1),r.emit(ge,{userId:a._id,members:A})}),[t]),n.useEffect(()=>{d.current&&d.current.scrollIntoView({behavior:"smooth"})},[h]);const X=n.useCallback(o=>{o.chatId===t&&p(I=>[...I,o.message])},[t]),K=n.useCallback(o=>{o.chatId===t&&v(!0)},[t]),Z=n.useCallback(o=>{o.chatId===t&&v(!1)},[t]),ee=n.useCallback(o=>{if(o.chatId!==t)return;const I={content:o.message,sender:{_id:"djasdhajksdhasdsadasdas",name:"Admin"},chat:t,createdAt:new Date().toISOString()};p(ne=>[...ne,I])},[t]),se={[je]:ee,[B]:X,[O]:K,[$]:Z};Te(r,se),be(Q);const te=[...V,...h];return i.isLoading?e.jsx(fe,{}):e.jsxs(n.Fragment,{children:[e.jsxs(D,{ref:m,boxSizing:"border-box",padding:"1rem",spacing:"1rem",bgcolor:"rgba(128,128,128,0.2)",height:"90%",sx:{overflowX:"hidden",overflowY:"auto"},children:[te.map(o=>e.jsx(_e,{message:o,user:a},o._id)),y&&e.jsx(he,{}),e.jsx("div",{ref:d})]}),e.jsx("form",{style:{height:"10%"},onSubmit:J,children:e.jsxs(D,{direction:"row",height:"100%",padding:"1rem",position:"relative",alignItems:"center",children:[e.jsx(P,{sx:{position:"absolute",left:"1.5rem",rotate:"30deg"},onClick:q,children:e.jsx(ke,{})}),e.jsx(xe,{placeholder:"Message",value:l,onChange:W}),e.jsx(P,{type:"submit",sx:{color:E,marginLeft:"1rem",padding:"0.5rem","&:hover":{bgcolor:E,color:"white"}},children:e.jsx(Ie,{})})]})}),e.jsx(Re,{anchorE1:k,chatId:t})]})},ss=Ae()(ze);export{ss as default};
